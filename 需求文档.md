# 二、需求文档（Requirements）

## 2.1 用户角色

当前只考虑「内部使用的单一用户/小团队」，不做复杂权限：

* **普通用户（默认）**

  * 可以执行检索
  * 可以将结果保存到本地数据库
  * 可以查看自己已收藏的论文列表
  * 可以对已收藏论文做简单标注（tag / note）

未来如需多用户，可以在数据库中增加 `users` 表和 `owner_id` 外键。

---

## 2.2 功能需求（Functional Requirements）

### 2.2.1 arXiv 检索功能

前端提供一个「检索面板」，允许用户指定如下参数：

1. **关键词与字段**

   * `all_terms`（全文元数据检索：标题+摘要+作者+评论等）
   * `title`（标题关键词，对应 `ti:`）
   * `abstract`（摘要关键词，对应 `abs:`）
   * `author`（作者，对应 `au:`）

2. **分类（Categories）**

   * 多选：`categories`，如：`["cs.LG", "cs.AI"]`
   * 在 search_query 中以 OR 逻辑组合：`(cat:cs.LG OR cat:cs.AI)`

3. **时间范围**

   * `date_mode`：`"submitted"` / `"updated"` / `null`

     * `"submitted"` → `submittedDate:[from TO to]`
     * `"updated"` → `lastUpdatedDate:[from TO to]`
   * `date_from`：起始日期（YYYY-MM-DD，可空）
   * `date_to`：结束日期（YYYY-MM-DD，可空）

4. **排序 & 数量**

   * `sort_by`：

     * `"relevance"`（默认）
     * `"submittedDate"`
     * `"lastUpdatedDate"`
   * `sort_order`：

     * `"descending"`（默认）
     * `"ascending"`
   * `max_results`：

     * 前端允许 1–50
     * 后端会再次强制 `<= 50`

> **分页说明**：
> 第一版不做「真实 arXiv 分页」，只做一次查询拿最多 50 条，全部展示在前端，前端内部分页（前端分页组件）即可。未来再扩展 `start` 分页参数。

---

### 2.2.2 检索结果展示

前端展示 arXiv 返回的结果列表（来自后端统一封装），单条记录字段：

* `arxiv_id`：如 `"2506.05176"`
* `version`：如 `"v3"`（可为空）
* `title`：标题
* `authors`：作者列表（字符串数组）
* `primary_category`：主分类，如 `"cs.LG"`
* `categories`：分类列表
* `summary`：摘要
* `published`：首次发表时间（ISO 字符串）
* `updated`：最后更新时间（ISO 字符串）
* `pdf_url`：PDF 链接
* `abs_url`：arXiv 摘要页链接
* `doi`：DOI（可空）
* `journal_ref`：期刊引用（可空）

列表展示要求：

* 简洁卡片/表格形式
* 默认展示：

  * 标题（点击跳 arXiv 页面新窗口）
  * 作者（前若干个 + “等”）
  * 主分类
  * 发表/更新日期
  * 简短摘要前 N 字符（例如前 300 字）
  * 「查看详情」按钮（跳转系统内部详情页）—— 可选
  * 「收藏」按钮（保存到本地数据库）

---

### 2.2.3 收藏/保存论文到本地数据库

用户在检索结果中点击「收藏」：

* 后端接收一个论文对象（或 ID + 补充信息）
* 在本地数据库中插入或更新 `papers` 表：

  * 若 `arxiv_id` 已存在：

    * 可选择：

      * 覆盖更新时间、标题、摘要等字段（简单模式）
      * 或只更新一个 `last_seen_at` 字段（用于统计）
* 同时创建一条 `user_papers` 记录（简单版可以只用一个表，直接存即可）

收藏功能需求：

1. **避免重复收藏**

   * 对同一 `arxiv_id`，再次收藏时不创建重复记录。
2. **可增加简单标注**

   * 用户可以在收藏时填写 `tags`（字符串、多标签用逗号）和 `note`（文本）。
   * 标注信息保存在本地数据库，不影响 Arxiv 原数据。

---

### 2.2.4 本地收藏管理

前端提供一个「我的收藏」页面，功能：

* 支持按以下条件过滤：

  * 标题关键词
  * 作者关键词
  * 分类（多选）
  * 标签（tags）
* 支持：

  * 按「收藏时间、发表时间、更新日期」排序
  * 分页展示（真正的 MySQL 分页）
* 支持操作：

  * 查看详情（系统内部详情页）
  * 取消收藏 / 删除本地记录
  * 编辑 tags / note

---

### 2.2.5 论文详情页（可选，但推荐）

点击「详情」或标题时可进入内部详情页，包含：

* 标题、作者列表、分类
* 摘要全文
* 发表 / 更新日期
* DOI、期刊引用
* pdf 链接、arxiv 链接（点击新窗口）
* 用户本地 tags、note（可编辑保存）
* 状态展示：

  * 是否已收藏
  * 收藏时间、本地更新时间

---

## 2.3 非功能需求（Non-Functional）

1. **稳定性 / 限流**

   * 所有 arXiv 请求必须通过 `arxiv_client.py` 中统一封装：

     * `page_size <= 50`
     * `delay_seconds >= 3`
     * `num_retries >= 3`
   * 禁止前端直接访问 arXiv API
   * 对于短时间多次刷新，同一个查询可以增加本地缓存（可后续版本实现）

2. **性能**

   * 单次查询最多 50 条结果，响应时间控制在数秒内（取决于 arXiv API）。
   * 本地收藏查询（MySQL）应有索引，保证在 1–2k 条数据时响应迅速。

3. **安全**

   * 该系统目前用于内网 / 开发环境，可不做复杂认证。
   * 但 API 设计尽量规格化，方便未来接入认证（如 token / JWT）。

4. **配置**

   * arXiv Client 的一些参数（delay, retries）放在后端配置文件或环境变量中。
   * 数据库连接通过环境变量配置。

5. **日志**

   * 后端记录：

     * 每次调用 arXiv 的 query 参数 + 状态（成功/失败、错误信息）
     * 本地收藏/删除操作日志（可简单打印到日志文件）。

---
